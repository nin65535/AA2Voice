class Input{constructor(){console.log("Input loaded"),$("table[set_title_url]").on("dblclick","tr[scene_id] input[readonly]",Input.enableInput),$("table[set_title_url]").on("keydown","tr[scene_id] input:not([readonly])",Input.onKeyDown)}static enableInput(t){$(t.currentTarget).removeAttr("readonly")}static onKeyDown(t){if(13===t.keyCode){var e=$("table[set_title_url]").attr("set_title_url"),r=$("input[name=_csrfToken]").val(),i={data:{scene_id:$(t.currentTarget).parents("tr[scene_id]").attr("scene_id"),title:$(t.currentTarget).val()},beforeSend:function(t){t.setRequestHeader("X-CSRF-Token",r)},url:e,method:"post"};$.ajax(i).done(Input.onSetTitleResult)}}static onSetTitleResult(t){var e=t.data.id;$('tr[scene_id="'+e+'"] input').attr("readonly","readonly")}}class PlayList{constructor(){console.log("PlayList loaded"),this.wavesurfer=WaveSurfer.create({container:"#waveform",normalize:!0,scrollParent:!0,waveColor:"#007bff"}),$("table.table-scene").on("dblclick","th.scene-group",this.playSceneGroup.bind(this)),$("table.table-scene").on("click","th.scene-group",this.selectSceneGroup.bind(this)),$(".btn-clear").on("click",this.clear.bind(this)),$(".btn-play").on("click",this.play.bind(this)),$(".btn-stop").on("click",this.stop.bind(this)),this.wavesurfer.on("finish",this.onFinish.bind(this))}selectSceneGroup(t){$(t.currentTarget).parents("tbody[scene_group]").find("td[voice_url]").addClass("in-list"),this.update()}playSceneGroup(t){this.clear(),this.selectSceneGroup(t),this.playFirst()}clear(t){$("td[voice_url]").removeClass("in-list"),$("td[voice_url]").removeClass("in-play"),this.update()}update(t){this.list=this.getList()}getList(){return $("td[voice_url].in-list").sort(function(t,e){return $(t).attr("scene_group")>$(e).attr("scene_group")?1:$(t).attr("scene_group")<$(e).attr("scene_group")?-1:Number($(t).attr("personality_id"))>Number($(e).attr("personality_id"))?1:Number($(t).attr("personality_id"))<Number($(e).attr("personality_id"))?-1:$(t).attr("voice_url")>$(e).attr("voice_url")?1:$(t).attr("voice_url")<$(e).attr("voice_url")?-1:void 0}).map(function(t,e){return $(e).attr("voice_url")}).toArray()}play(t){$("td[voice_url].in-play").attr("voice_url")?this.wavesurfer.play():this.playFirst()}playFirst(){this.playUrl(this.list[0])}playNext(){var t=$("td[voice_url].in-play").attr("voice_url"),e=this.list.indexOf(t);if(-1===e)return this.playFirst();var r=this.list[e+1];return r?this.playUrl(r):this.stop()}playUrl(t){this.stop(),$('td[voice_url="'+t+'"]').addClass("in-play"),this.wavesurfer.load(t);var e=this;this.wavesurfer.once("ready",function(){e.initDuration(),e.wavesurfer.play()})}initDuration(){var t=Math.ceil(1e3*this.wavesurfer.getDuration());$(".duration").html(t)}stop(){$("td[voice_url]").removeClass("in-play"),this.wavesurfer.empty()}onFinish(t){this.playNext()}}